@using Neira.Web.Models.NeiraLink
@model IEnumerable<Neira.Web.Models.NeiraLink.Clan_Member>
@{
	Layout = "~/Views/Shared/Layouts/_ClanLayout.cshtml";
	var CurrentClan = (Clan)ViewData["CurrentGuild"];
	ViewData["Title"] = $"Нейроматрица | Клан {CurrentClan.Name}";
}
<!-- Header -->
<div class="container text-center">
	<h2>Клан <a asp-controller="Clan" asp-action="OpenClan" asp-route-id="@CurrentClan.Id" rel="nofollow" target="_blank">@Html.Raw(CurrentClan.Name)</a></h2>
	<p><b>Дата создания:</b> @Html.Raw(CurrentClan.CreateDate.ToString("dd.MM.yyyy")) | <b>Стражей:</b> @Html.Raw(CurrentClan.MemberCount)</p>
	<p><b>Девиз:</b> @Html.Raw(CurrentClan.Motto)</p>
	<p><b>О клане:</b> @Html.Raw(CurrentClan.About)</p>
</div>
<div class="container" style="margin-top:1rem;" id="members">
	<h4>Стражи</h4>
	<form asp-action="Index" method="get">
		<div>
			<p>
				Поиск по имени: <input type="text" class="form-control-sm" name="SearchString" value="@ViewData["currentFilter"]" />
				<input type="submit" class="btn btn-primary" value="Найти" /> |
				<a asp-action="Index" asp-route-id="@CurrentClan.Id">Сбросить фильтры</a>
			</p>
		</div>
	</form>
	<p>
		Данные о персонажах обновляются раз в <b>15 минут</b>.
	</p>
	<table class="table table-hover">
		<thead>
			<tr>
				<th>Аватар</th>
				<th>
					<a asp-action="Index" asp-route-sortOrder="@ViewData["NameSortParm"]">Имя</a>
				</th>
				<th>
					<a asp-action="Index" asp-route-sortOrder="@ViewData["DateSortParm"]">Дата вступления</a>
				</th>
				<th>
					<a asp-action="Index" asp-route-sortOrder="@ViewData["DateLastPlayedSortParm"]">Последний раз был в игре</a>
				</th>
				<th>Действия</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var item in Model)
			{
				<tr>
					<td><img class="img-thumbnail" src="@Html.Raw($"http://bungie.net{item.IconPath}")" style="max-height:3rem;" /></td>
					<td>
						<a asp-area="" asp-controller="Clan" asp-action="OpenProfile" asp-route-type="@item.DestinyMembershipType" asp-route-id="@item.DestinyMembershipId" rel="nofollow" target="_blank">@Html.DisplayFor(modelItem => item.Name)</a>
					</td>
					<td>
						@Html.DisplayFor(modelItem => item.ClanJoinDate)
					</td>
					<td class="text-center">
						@if (item.DateLastPlayed.HasValue)
						{
							@Html.DisplayFor(modelItem => item.DateLastPlayed)
						}
						else
						{
							<span class="text-danger">Профиль скрыт или недоступен</span>
						}
					</td>
					<td>
						@if (item.ErrorCode == 0)
						{
						<span class="text-warning">Нет данных</span>
						}
						else if (item.ErrorCode == 1665)
						{
						<span class="text-danger">Профиль скрыт</span>
						}
						else
						{
						<a class="btn btn-primary" asp-controller="Clan" asp-action="Detail" asp-route-Id="@item.Id" target="_blank">Активность</a>
						}
					</td>
				</tr>
			}
		</tbody>
	</table>
</div>